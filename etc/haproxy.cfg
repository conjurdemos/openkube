global
	maxconn 256
	external-check

defaults
	timeout connect 5000ms
	timeout client 50000ms
	timeout server 50000ms

frontend f_conjur_master_http
	mode tcp
	bind *:443
	default_backend b_conjur_master_http

frontend f_conjur_master_pg
	mode tcp
	bind *:5432
	default_backend b_conjur_master_pg

frontend f_conjur_master_ldap
	mode tcp
	bind *:636
	default_backend b_conjur_master_ldap

# HTTP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/openkube/etc
backend b_conjur_master_http
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server conjur-stateful-node-0 172.17.0.2:443 check
	 server conjur-stateful-node-1 172.17.0.3:443 check
	 server conjur-stateful-node-2 172.17.0.4:443 check

# PG backend info
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/openkube/etc
backend b_conjur_master_pg
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server conjur-stateful-node-0 172.17.0.2:5432 check
	 server conjur-stateful-node-1 172.17.0.3:5432 check
	 server conjur-stateful-node-2 172.17.0.4:5432 check

# LDAP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/openkube/etc
backend b_conjur_master_ldap
	mode tcp
	balance static-rr
	option external-check
	default-server inter 30s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server conjur-stateful-node-0 172.17.0.2:636 check
	 server conjur-stateful-node-1 172.17.0.3:636 check
	 server conjur-stateful-node-2 172.17.0.4:636 check
